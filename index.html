<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Рецепты Bubble Street</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        :root { --primary-color: #8a2be2; --light-primary-color: #eadafb; }
        body, html { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; height: 100%; background-color: #f4f4f9; }
        .app-container { display: flex; height: 100vh; flex-direction: row; }
        .sidebar { width: 300px; background-color: #ffffff; border-right: 1px solid #ddd; display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar-header { padding: 15px 20px; border-bottom: 1px solid #eee; }
        .sidebar-header h2 { margin: 0; font-size: 1.2em; }
        .sidebar-tabs { display: flex; border-bottom: 1px solid #eee; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: #f8f9fa; cursor: pointer; font-size: 1em; }
        .tab-btn.active { background: #fff; border-bottom: 3px solid var(--primary-color); font-weight: bold; }
        .sidebar-content { overflow-y: auto; flex-grow: 1; }
        .sidebar-footer { padding: 10px; border-top: 1px solid #eee; }
        .list-container { list-style: none; padding: 0; margin: 0; }
        .list-container a { display: block; padding: 15px 20px; color: #333; text-decoration: none; transition: background-color 0.2s; border-bottom: 1px solid #f0f0f0; }
        .list-container a:hover { background-color: #f0f0f0; }
        .list-container a.active { background-color: var(--light-primary-color); font-weight: bold; color: var(--primary-color); }
        .content { flex-grow: 1; padding: 25px; overflow-y: auto; }
        .content-placeholder { display: flex; justify-content: center; align-items: center; height: 100%; color: #888; font-size: 1.5em; text-align: center; }

        /* --- НОВЫЙ ДВУХКОЛОНОЧНЫЙ МАКЕТ --- */
        .recipe-view-container { display: flex; gap: 30px; align-items: flex-start; }
        .recipe-details { flex: 1.5; min-width: 0; } /* Текст занимает больше места */
        .recipe-image-container { flex: 1; min-width: 0; position: sticky; top: 25px; } /* Картинка "прилипает" при скролле */
        .recipe-image-container img { width: 100%; height: auto; border-radius: 12px; object-fit: contain; max-height: 80vh; }

        .recipe-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;}
        h1 { margin: 0; }
        .steps-list { list-style-type: none; padding-left: 0; counter-reset: step-counter; }
        .steps-list > li { counter-increment: step-counter; margin-bottom: 20px; display: flex; align-items: flex-start; }
        .steps-list > li::before { content: counter(step-counter); margin-right: 15px; background-color: var(--primary-color); color: white; width: 35px; height: 35px; border-radius: 50%; display: inline-flex; justify-content: center; align-items: center; font-weight: bold; flex-shrink: 0; }
        .step-wrapper { display: flex; flex-direction: column; width: 100%; }
        .step-description { font-weight: 500; margin-bottom: 12px; font-size: 1.1em; }
        .step-ingredients-table { border-collapse: collapse; width: 100%; table-layout: fixed; }
        .step-ingredients-table th, .step-ingredients-table td { border: 1px solid #e0e0e0; padding: 10px 12px; text-align: left; word-wrap: break-word; }
        .step-ingredients-table th { background-color: #f8f9fa; font-size: 0.9em; }
        
        .volume-selector { text-align: center; padding: 20px 0; }
        .volume-selector-buttons { display: flex; gap: 20px; justify-content: center; margin-top: 20px; }
        .volume-btn { font-size: 1.5em; padding: 20px 40px; border-radius: 10px; cursor: pointer; border: 2px solid var(--primary-color); background: #fff; color: var(--primary-color); }
        .volume-toggle { display: flex; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 8px; overflow: hidden; }
        .toggle-btn { padding: 10px 20px; background: #f0f0f0; border: none; cursor: pointer; font-size: 1em; flex-grow: 1; }
        .toggle-btn.active { background: var(--primary-color); color: white; }
        
        .edit-controls button, .btn { padding: 8px 15px; border: 1px solid #ccc; background-color: #f0f0f0; border-radius: 5px; cursor: pointer; margin-left: 10px; }
        .btn-primary { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .btn-danger { background-color: #dc3545; color: white; border-color: #dc3545; }
        .btn-full-width { width: 100%; padding: 12px; font-size: 1.1em; margin: 0; }
        .edit-form input, .edit-form textarea { width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .edit-step { border: 1px dashed #ccc; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
        .edit-ingredient, .edit-step { cursor: grab; }
        .sortable-ghost { opacity: 0.4; background: #c8ebfb; }
        .edit-ingredient-container { display: flex; flex-direction: column; gap: 5px; }
        .edit-ingredient { display: grid; grid-template-columns: 1fr 80px 80px auto; gap: 10px; align-items: center; }
        .edit-ingredient-header { display: grid; grid-template-columns: 1fr 80px 80px auto; gap: 10px; font-weight: bold; font-size: 0.9em; }
        
        /* --- АДАПТИВНОСТЬ ДЛЯ ПЛАНШЕТОВ И ТЕЛЕФОНОВ --- */
        @media (max-width: 1000px) {
            .recipe-view-container { flex-direction: column-reverse; } /* Ставит картинку под текст */
            .recipe-image-container { position: static; width: 100%; margin-top: 20px; }
            .recipe-image-container img { max-height: 400px; object-fit: cover; } /* На мобильных лучше обрезать для красоты */
        }
        @media (max-width: 768px) {
            .app-container { flex-direction: column; height: auto; }
            .sidebar { width: 100%; border-right: none; border-bottom: 1px solid #ddd; max-height: 40vh; }
            .content { padding: 15px; }
            .edit-ingredient { grid-template-columns: 1fr 60px 60px auto; gap: 5px; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header"><h2>Меню</h2></div>
            <div class="sidebar-tabs">
                <button class="tab-btn active" id="tab-drinks">Напитки</button>
                <button class="tab-btn" id="tab-preps">Заготовки</button>
            </div>
            <div class="sidebar-content">
                <ul id="drinks-list" class="list-container"></ul>
                <ul id="preps-list" class="list-container" style="display: none;"></ul>
            </div>
            <div class="sidebar-footer">
                <button id="new-item-btn" class="btn btn-primary btn-full-width">Создать новый напиток</button>
            </div>
        </nav>
        <main class="content">
            <div id="content-output"><div class="content-placeholder"><p>← Выберите элемент из меню</p></div></div>
        </main>
    </div>
    
    <script>
    // =======================================================================
    // ИСХОДНЫЕ ДАННЫЕ С ФОТОГРАФИЯМИ
    // =======================================================================
    const initialData = {
        recipes: {
            'oreo': {
                name: 'Орео',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/oreo.jpg',
                allIngredients: { 'tapioca': { name: 'Тапиока', size500: '80', size650: '100' }, 'milk': { name: 'Молоко 3,2%', size500: '140', size650: '180' }, 'assam-tea': { name: 'Чай Ассам заготовка', size500: '50', size650: '75' }, 'condensed-milk': { name: 'Сгущеное молоко', size500: '25', size650: '30' }, 'cocoa-prep': { name: 'Какао заготовка', size500: '25', size650: '30' }, 'cane-syrup': { name: 'Тростниковый сироп', size500: '5', size650: '5' }, 'cheese-foam': { name: 'Сырная пенка', size500: '70', size650: '70' }, 'ice': { name: 'Лед', size500: '120', size650: '150' }, 'oreo-crumbs': { name: 'Крошка печенья Орео', size500: '', size650: '' } },
                steps: [ { description: 'В шейкере смешать:', ingredientKeys: ['assam-tea', 'milk', 'condensed-milk', 'cocoa-prep'] }, { description: 'В стакан добавить:', ingredientKeys: ['tapioca', 'ice', 'cane-syrup'] }, { description: 'Перелить содержимое шейкера в стакан.', ingredientKeys: [] }, { description: 'Украсить:', ingredientKeys: ['cheese-foam', 'oreo-crumbs'] } ]
            },
            'salted-caramel': {
                name: 'Соленый крекер',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/solyoniy-kreker.jpg',
                allIngredients: { 'tapioca': { name: 'Тапиока', size500: '80', size650: '100' }, 'milk': { name: 'Молоко 3,2%', size500: '140', size650: '180' }, 'assam-tea': { name: 'Чай Ассам заготовка', size500: '50', size650: '75' }, 'caramel-topping': { name: 'Топпинг Соленая карамель', size500: '55', size650: '70' }, 'cane-syrup': { name: 'Тростниковый сироп', size500: '5', size650: '5' }, 'cheese-foam': { name: 'Сырная пенка', size500: '70', size650: '70' }, 'ice': { name: 'Лед', size500: '120', size650: '150' }, 'cracker-crumbs': { name: 'Крошка печенья "соленый крекер"', size500: '', size650: '' } },
                steps: [ { description: 'В шейкере смешать:', ingredientKeys: ['milk', 'assam-tea', 'caramel-topping'] }, { description: 'В стакан добавить:', ingredientKeys: ['tapioca', 'ice', 'cane-syrup'] }, { description: 'Перелить содержимое шейкера в стакан.', ingredientKeys: [] }, { description: 'Украсить:', ingredientKeys: ['cheese-foam', 'cracker-crumbs'] } ]
            },
            'cocoa': {
                name: 'Какао',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/kakao.jpg',
                allIngredients: { 'tapioca': { name: 'Тапиока', size500: '80', size650: '100' }, 'milk': { name: 'Молоко', size500: '140', size650: '180' }, 'cocoa-prep': { name: 'Какао Заготовка', size500: '35', size650: '45' }, 'cane-syrup': { name: 'Тростниковый сироп', size500: '20', size650: '25' }, 'cheese-foam': { name: 'Сырная пенка', size500: '70', size650: '70' }, 'ice': { name: 'Лед', size500: '120', size650: '150' }, 'cocoa-powder': { name: 'Какао порошок (для посыпки)', size500: '', size650: '' } },
                steps: [ { description: 'В шейкере смешать:', ingredientKeys: ['milk', 'cocoa-prep', 'cane-syrup'] }, { description: 'В стакан добавить:', ingredientKeys: ['tapioca', 'ice'] }, { description: 'Перелить содержимое в стакан.', ingredientKeys: [] }, { description: 'Украсить:', ingredientKeys: ['cheese-foam', 'cocoa-powder'] } ]
            },
            'matcha-coconut': {
                name: 'Зеленая матча кокос',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/zelyonaya-matcha-kokos.jpg',
                allIngredients: { 'tapioca': { name: 'Тапиока', size500: '80', size650: '100' }, 'milk': { name: 'Молоко', size500: '140', size650: '180' }, 'matcha-prep': { name: 'Матча Заготовка', size500: '35', size650: '45' }, 'coconut-concentrate': { name: 'Концентрат кокос', size500: '20', size650: '25' }, 'cheese-foam': { name: 'Сырная пенка', size500: '70', size650: '70' }, 'ice': { name: 'Лед', size500: '120', size650: '150' }, 'cane-syrup': { name: 'Тростниковый сироп', size500: '5', size650: '5' }, 'matcha-powder': { name: 'Матча порошок', size500: '', size650: '' } },
                steps: [ { description: 'В шейкере смешать:', ingredientKeys: ['milk', 'matcha-prep', 'coconut-concentrate'] }, { description: 'В стакан добавить:', ingredientKeys: ['tapioca', 'ice', 'cane-syrup'] }, { description: 'Перелить содержимое в стакан.', ingredientKeys: [] }, { description: 'Украсить:', ingredientKeys: ['cheese-foam', 'matcha-powder'] } ]
            },
            'berry-mood': {
                name: 'Ягодное настроение',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/yagodnoye-nastroenie.jpg',
                allIngredients: { 'tapioca': { name: 'Тапиока', size500: '80', size650: '100' }, 'assam-tea': { name: 'Чай ассам заготовка', size500: '50', size650: '75' }, 'milk': { name: 'Молоко 3,2%', size500: '140', size650: '180' }, 'raspberry-concentrate': { name: 'Концентрат Малина', size500: '25', size650: '30' }, 'blueberry-concentrate': { name: 'Концентрат Черника', size500: '25', size650: '30' }, 'cane-syrup': { name: 'Тростниковый сироп', size500: '5', size650: '5' }, 'ice': { name: 'Лед', size500: '120', size650: '150' }, 'cheese-foam': { name: 'Сырная пенка', size500: '70', size650: '70' }, 'berries-garnish': { name: 'Ягоды черники/малины', size500: '', size650: '' } },
                steps: [ { description: 'В шейкере смешать:', ingredientKeys: ['assam-tea', 'milk', 'raspberry-concentrate', 'blueberry-concentrate'] }, { description: 'В стакан добавить:', ingredientKeys: ['tapioca', 'ice', 'cane-syrup'] }, { description: 'Перелить содержимое шейкера в стакан.', ingredientKeys: [] }, { description: 'Украсить:', ingredientKeys: ['cheese-foam', 'berries-garnish'] } ]
            },
            'banana-ice-cream': {
                name: 'Банановое мороженое',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/banan.jpg',
                allIngredients: { 'tapioca': { name: 'Тапиока', size500: '80', size650: '100' }, 'assam-tea': { name: 'Чай ассам заготовка', size500: '50', size650: '75' }, 'milk': { name: 'Молоко', size500: '140', size650: '180' }, 'banana-concentrate': { name: 'Концентрат Банан', size500: '35', size650: '40' }, 'condensed-milk': { name: 'Сгущеное молоко', size500: '25', size650: '30' }, 'ice': { name: 'Лед', size500: '120', size650: '150' }, 'cheese-foam': { name: 'Сырная пенка', size500: '70', size650: '70' } },
                steps: [ { description: 'В шейкере смешать:', ingredientKeys: ['assam-tea', 'milk', 'banana-concentrate', 'condensed-milk'] }, { description: 'В стакан добавить:', ingredientKeys: ['tapioca', 'ice'] }, { description: 'Перелить содержимое шейкера в стакан.', ingredientKeys: [] }, { description: 'Украсить:', ingredientKeys: ['cheese-foam'] } ]
            },
            'snickers': {
                name: 'Сникерс (милкшейк)',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/snickers.jpg',
                allIngredients: { 'tapioca': { name: 'Тапиока', size500: '80', size650: '100' }, 'ice-cream': { name: 'Мороженое 15-20%', size500: '180', size650: '230' }, 'milk': { name: 'Молоко 3,2%', size500: '180', size650: '230' }, 'caramel-syrup': { name: 'Сироп/топинг карамель', size500: '20', size650: '30' }, 'nut-syrup': { name: 'Сироп лесной орех', size500: '10', size650: '20' }, 'peanuts': { name: 'Жареный Арахис', size500: '5', size650: '5' } },
                steps: [ { description: 'В блендере взбить:', ingredientKeys: ['ice-cream', 'milk', 'caramel-syrup', 'nut-syrup'] }, { description: 'В стакан добавить:', ingredientKeys: ['tapioca'] }, { description: 'Перелить содержимое блендера в стакан.', ingredientKeys: [] }, { description: 'Украсить:', ingredientKeys: ['peanuts'] } ]
            },
            'bounty': {
                name: 'Баунти (милкшейк)',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/bounty.jpg',
                allIngredients: { 'tapioca': { name: 'Тапиока', size500: '80', size650: '100' }, 'ice-cream': { name: 'Мороженое 15-20%', size500: '190', size650: '240' }, 'milk': { name: 'Молоко 3,2%', size500: '180', size650: '230' }, 'coconut-concentrate': { name: 'Концентрат Кокос', size500: '20', size650: '30' }, 'almond-syrup': { name: 'Сироп миндаль', size500: '10', size650: '20' }, 'coconut-flakes': { name: 'Кокосовая стружка', size500: '5', size650: '5' } },
                steps: [ { description: 'В блендере взбить:', ingredientKeys: ['ice-cream', 'milk', 'coconut-concentrate', 'almond-syrup'] }, { description: 'В стакан добавить:', ingredientKeys: ['tapioca'] }, { description: 'Перелить содержимое блендера в стакан.', ingredientKeys: [] }, { description: 'Украсить:', ingredientKeys: ['coconut-flakes'] } ]
            },
            'blueberry-strawberry': {
                name: 'Черника-Клубника (милкшейк)',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/chernika-klubnika.jpg',
                allIngredients: { 'tapioca-balls': { name: 'Тапиока/Джусболы', size500: '80', size650: '100' }, 'ice-cream': { name: 'Мороженое 15-20%', size500: '150', size650: '200' }, 'milk': { name: 'Молоко 3,2%', size500: '180', size650: '230' }, 'strawberry-puree': { name: 'Ягода(пюре) Клубника', size500: '20', size650: '30' }, 'blueberry-puree': { name: 'Ягода(пюре) Черника', size500: '20', size650: '30' }, 'strawberry-topping': { name: 'Топинг клубника', size500: '20', size650: '30' } },
                steps: [ { description: 'В блендере взбить:', ingredientKeys: ['ice-cream', 'milk', 'strawberry-puree', 'blueberry-puree', 'strawberry-topping'] }, { description: 'В стакан добавить:', ingredientKeys: ['tapioca-balls'] }, { description: 'Перелить содержимое блендера в стакан.', ingredientKeys: [] } ]
            },
            'lemonade-raspberry-pomegranate': {
                name: 'Лимонад Малина-Гранат',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/limonad-malina-granat.jpg',
                allIngredients: { 'juice-balls': { name: 'Джус боллы', size500: '60', size650: '80' }, 'sparkling-water': { name: 'Газированная Вода', size500: '225', size650: '275' }, 'raspberry-concentrate': { name: 'Концентрат Малина', size500: '40', size650: '35' }, 'berries': { name: 'Ягода малина,гранат', size500: '10/10', size650: '15/15' }, 'ice': { name: 'Лед', size500: '150', size650: '200' }, 'grenadine': { name: 'Сироп Гренадин', size500: '20', size650: '35' } },
                steps: [ { description: 'В питчере смешать (ложкой):', ingredientKeys: ['raspberry-concentrate', 'grenadine', 'berries', 'sparkling-water'] }, { description: 'В стакан добавить:', ingredientKeys: ['juice-balls', 'ice'] }, { description: 'Перелить содержимое в стакан.', ingredientKeys: [] } ]
            },
            'lemonade-mango-passion': {
                name: 'Лимонад Манго-Маракуйя',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/limonad-mango-marakuya.jpg',
                allIngredients: { 'juice-balls': { name: 'Джус боллы', size500: '60', size650: '80' }, 'sparkling-water': { name: 'Газированная Вода', size500: '225', size650: '275' }, 'mango-passion-concentrate': { name: 'Концентрат Манго-Маракуйя', size500: '60', size650: '80' }, 'mango-pieces': { name: 'Манго свежее кусочки', size500: '20', size650: '30' }, 'ice': { name: 'Лед', size500: '150', size650: '200' } },
                steps: [ { description: 'В питчере смешать (ложкой):', ingredientKeys: ['mango-passion-concentrate', 'mango-pieces', 'sparkling-water'] }, { description: 'В стакан добавить:', ingredientKeys: ['juice-balls', 'ice'] }, { description: 'Перелить содержимое в стакан.', ingredientKeys: [] } ]
            },
            'lemonade-pear-kiwi': {
                name: 'Лимонад Груша-Киви',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/limonad-grusha-kivi.jpg',
                allIngredients: { 'juice-balls': { name: 'Джус боллы', size500: '60', size650: '80' }, 'sparkling-water': { name: 'Газированная Вода', size500: '225', size650: '275' }, 'pear-concentrate': { name: 'Концентрат Груша', size500: '40', size650: '50' }, 'kiwi-concentrate': { name: 'Концентрат Киви', size500: '20', size650: '25' }, 'kiwi-fresh': { name: 'Киви свежий', size500: '20', size650: '30' }, 'ice': { name: 'Лед', size500: '150', size650: '200' } },
                steps: [ { description: 'В питчере смешать (ложкой):', ingredientKeys: ['pear-concentrate', 'kiwi-concentrate', 'sparkling-water'] }, { description: 'В стакан добавить:', ingredientKeys: ['juice-balls', 'kiwi-fresh', 'ice'] }, { description: 'Перелить содержимое в стакан.', ingredientKeys: [] } ]
            },
            'lemonade-pineapple-peach': {
                name: 'Лимонад Ананас-Персик',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/limonad-ananas-persik.jpg',
                allIngredients: { 'juice-balls': { name: 'Джус боллы', size500: '60', size650: '80' }, 'sparkling-water': { name: 'Газированная Вода', size500: '225', size650: '275' }, 'pineapple-concentrate': { name: 'Концентрат Ананас', size500: '40', size650: '50' }, 'peach-concentrate': { name: 'Концентрат Персик', size500: '20', size650: '25' }, 'ice': { name: 'Лед', size500: '150', size650: '200' } },
                steps: [ { description: 'В питчере смешать (ложкой):', ingredientKeys: ['pineapple-concentrate', 'peach-concentrate', 'sparkling-water'] }, { description: 'В стакан добавить:', ingredientKeys: ['juice-balls', 'ice'] }, { description: 'Перелить содержимое в стакан.', ingredientKeys: [] } ]
            },
            'tea-raspberry-pomegranate': {
                name: 'Джус боллы Малина-Гранат',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/balls-malina-granat.jpg',
                allIngredients: { 'juice-balls': { name: 'Джус боллы', size500: '60', size650: '80' }, 'green-tea': { name: 'Чай зеленый с жасмином', size500: '100', size650: '125' }, 'water': { name: 'Вода', size500: '125', size650: '150' }, 'raspberry-concentrate': { name: 'Концентрат Малина', size500: '40', size650: '50' }, 'berries': { name: 'Ягода малина,гранат', size500: '10/10', size650: '15/15' }, 'grenadine': { name: 'Сироп Гренадин', size500: '20', size650: '25' }, 'ice': { name: 'Лед', size500: '120', size650: '150' } },
                steps: [ { description: 'В шейкере смешать:', ingredientKeys: ['green-tea', 'water', 'raspberry-concentrate', 'grenadine', 'berries'] }, { description: 'В стакан добавить:', ingredientKeys: ['juice-balls', 'ice'] }, { description: 'Перелить содержимое шейкера в стакан.', ingredientKeys: [] } ]
            },
            'tea-mango-passion': {
                name: 'Джус боллы Манго-Маракуйя',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/balls-mango-marakuya.jpg',
                allIngredients: { 'juice-balls': { name: 'Джус боллы', size500: '60', size650: '80' }, 'green-tea': { name: 'Чай зеленый с жасмином', size500: '120', size650: '150' }, 'water': { name: 'Вода', size500: '100', size650: '120' }, 'mango-passion-concentrate': { name: 'Концентрат Манго-Маракуйя', size500: '60', size650: '80' }, 'mango-pieces': { name: 'Манго свежее кусочки', size500: '20', size650: '30' }, 'ice': { name: 'Лед', size500: '120', size650: '150' } },
                steps: [ { description: 'В шейкере смешать:', ingredientKeys: ['green-tea', 'water', 'mango-passion-concentrate', 'mango-pieces'] }, { description: 'В стакан добавить:', ingredientKeys: ['juice-balls', 'ice'] }, { description: 'Перелить содержимое шейкера в стакан.', ingredientKeys: [] } ]
            },
            'tea-pear-kiwi': {
                name: 'Джус боллы Груша-Киви',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/balls-grusha-kivi.jpg',
                allIngredients: { 'juice-balls': { name: 'Джус боллы', size500: '60', size650: '80' }, 'green-tea': { name: 'Чай зеленый с жасмином', size500: '120', size650: '150' }, 'water': { name: 'Вода', size500: '100', size650: '120' }, 'pear-concentrate': { name: 'Концентрат Груша', size500: '40', size650: '50' }, 'kiwi-concentrate': { name: 'Концентрат Киви', size500: '20', size650: '25' }, 'kiwi-fresh': { name: 'Киви свежий', size500: '20', size650: '30' }, 'ice': { name: 'Лед', size500: '120', size650: '150' } },
                steps: [ { description: 'В шейкере смешать:', ingredientKeys: ['green-tea', 'water', 'pear-concentrate', 'kiwi-concentrate'] }, { description: 'В стакан добавить:', ingredientKeys: ['juice-balls', 'kiwi-fresh', 'ice'] }, { description: 'Перелить содержимое шейкера в стакан.', ingredientKeys: [] } ]
            },
            'tea-pineapple-peach': {
                name: 'Джус боллы Ананас-Персик',
                imageUrl: 'https://raw.githubusercontent.com/dtorkin/bubble-street/refs/heads/main/photo/balls-ananas-persik.jpg',
                allIngredients: { 'juice-balls': { name: 'Джус боллы', size500: '60', size650: '80' }, 'green-tea': { name: 'Чай зеленый с жасмином', size500: '120', size650: '150' }, 'water': { name: 'Вода', size500: '100', size650: '120' }, 'pineapple-concentrate': { name: 'Концентрат Ананас', size500: '40', size650: '50' }, 'peach-concentrate': { name: 'Концентрат Персик', size500: '20', size650: '25' }, 'ice': { name: 'Лед', size500: '120', size650: '150' } },
                steps: [ { description: 'В шейкере смешать:', ingredientKeys: ['green-tea', 'water', 'pineapple-concentrate', 'peach-concentrate'] }, { description: 'В стакан добавить:', ingredientKeys: ['juice-balls', 'ice'] }, { description: 'Перелить содержимое шейкера в стакан.', ingredientKeys: [] } ]
            }
        },
        preparations: {
            'cocoa-prep': {
                name: 'Какао заготовка',
                description: 'В питчере тщательно смешать 10 грамм какао-порошка и 100 мл горячей воды до полного растворения.'
            },
            'assam-tea': {
                name: 'Чай Ассам заготовка',
                description: '25 грамм чая "Ассам" заварить в 1 литре воды (95°C) в течение 10 минут, затем процедить.'
            },
            'jasmine-green-tea': {
                name: 'Чай зеленый с жасмином заготовка',
                description: '20 грамм зеленого чая с жасмином заварить в 1 литре воды (80°C) в течение 5-7 минут, затем процедить.'
            }
        }
    };
    
    // =======================================================================
    // ОСНОВНАЯ ЛОГИКА ПРИЛОЖЕНИЯ (ДАЛЬШЕ ЛУЧШЕ НЕ РЕДАКТИРОВАТЬ)
    // =======================================================================
    let appData = {};
    let activeKey = null;
    let selectedVolume = null;
    let activeTab = 'drinks';
    let sortableInstances = [];

    function saveData() { localStorage.setItem('bubbleStreetMenu', JSON.stringify(appData)); }
    function loadData() {
        const saved = localStorage.getItem('bubbleStreetMenu');
        appData = (saved && JSON.parse(saved).recipes && Object.keys(JSON.parse(saved).recipes).length > 0) ? JSON.parse(saved) : JSON.parse(JSON.stringify(initialData));
    }
    
    function renderLists() {
        const drinksList = document.getElementById('drinks-list');
        const prepsList = document.getElementById('preps-list');
        drinksList.innerHTML = '';
        prepsList.innerHTML = '';
        
        Object.keys(appData.recipes).sort((a,b) => appData.recipes[a].name.localeCompare(appData.recipes[b].name)).forEach(key => {
            const link = document.createElement('a');
            link.href = '#';
            link.textContent = appData.recipes[key].name;
            link.dataset.key = key;
            link.dataset.type = 'recipe';
            if (key === activeKey && activeTab === 'drinks') link.classList.add('active');
            const item = document.createElement('li');
            item.appendChild(link);
            drinksList.appendChild(item);
        });

        Object.keys(appData.preparations).sort((a,b) => appData.preparations[a].name.localeCompare(appData.preparations[b].name)).forEach(key => {
            const link = document.createElement('a');
            link.href = '#';
            link.textContent = appData.preparations[key].name;
            link.dataset.key = key;
            link.dataset.type = 'prep';
            if (key === activeKey && activeTab === 'preps') link.classList.add('active');
            const item = document.createElement('li');
            item.appendChild(link);
            prepsList.appendChild(item);
        });
    }
    
    function renderContent(type, key) {
        activeKey = key;
        const output = document.getElementById('content-output');
        if (type === 'recipe') {
            selectedVolume = null;
            const recipe = appData.recipes[key];
            const detailsHtml = `
                <div class="volume-selector">
                    <h1>${recipe.name}</h1>
                    <p style="font-size: 1.2em; color: #555;">Выберите объем:</p>
                    <div class="volume-selector-buttons">
                        <button class="volume-btn" onclick="renderRecipeForVolume('${key}', '500')">500 мл</button>
                        <button class="volume-btn" onclick="renderRecipeForVolume('${key}', '650')">650 мл</button>
                    </div>
                </div>`;
            const imageHtml = recipe.imageUrl ? `<div class="recipe-image-container"><img src="${recipe.imageUrl}" alt="${recipe.name}"></div>` : '';
            output.innerHTML = `<div class="recipe-view-container"><div class="recipe-details">${detailsHtml}</div>${imageHtml}</div>`;
        
        } else if (type === 'prep') {
            const prep = appData.preparations[key];
            output.innerHTML = `
                <div class="recipe-header"><h1>${prep.name}</h1>
                    <div class="edit-controls"><button class="btn" onclick="renderPrepEdit('${key}')">Редактировать</button></div>
                </div>
                <div style="font-size: 1.2em; line-height: 1.6;">${prep.description.replace(/\n/g, '<br>')}</div>`;
        }
        renderLists();
    }
function renderRecipeForVolume(key, volume) {
        selectedVolume = volume;
        const recipe = appData.recipes[key];
        const output = document.getElementById('content-output');

        const stepsHtml = recipe.steps.map(step => {
            let ingredientsTableHtml = '';
            if (step.ingredientKeys?.length > 0) {
                const rows = step.ingredientKeys.map(ingKey => {
                    const ingData = recipe.allIngredients[ingKey];
                    const amount = ingData ? (ingData['size' + volume] || '') : '';
                    return ingData ? `<tr><td>${ingData.name}</td><td>${amount}</td></tr>` : '';
                }).join('');
                ingredientsTableHtml = `<table class="step-ingredients-table"><thead><tr><th>Ингредиент</th><th>Кол-во (${volume}мл)</th></tr></thead><tbody>${rows}</tbody></table>`;
            }
            return `<li><div class="step-wrapper"><div class="step-description">${step.description}</div>${ingredientsTableHtml}</div></li>`;
        }).join('');

        const detailsHtml = `
            <div class="recipe-header"><h1>${recipe.name}</h1><div class="edit-controls"><button class="btn" onclick="renderRecipeEdit('${key}')">Редактировать</button></div></div>
            <div class="volume-toggle">
                <button class="toggle-btn ${volume === '500' ? 'active' : ''}" onclick="renderRecipeForVolume('${key}', '500')">500 мл</button>
                <button class="toggle-btn ${volume === '650' ? 'active' : ''}" onclick="renderRecipeForVolume('${key}', '650')">650 мл</button>
            </div>
            <ol class="steps-list">${stepsHtml}</ol>
        `;
        const imageHtml = recipe.imageUrl ? `<div class="recipe-image-container"><img src="${recipe.imageUrl}" alt="${recipe.name}"></div>` : '';
        
        output.innerHTML = `<div class="recipe-view-container"><div class="recipe-details">${detailsHtml}</div>${imageHtml}</div>`;
    }
    
    function renderRecipeEdit(key) {
        destroySortables();
        const recipe = appData.recipes[key];
        const output = document.getElementById('content-output');
        let stepsHtml = recipe.steps.map((step, stepIndex) => renderEditStep(key, step, stepIndex)).join('');
        output.innerHTML = `
            <div class="edit-form">
                <h2>Редактирование "${recipe.name}"</h2>
                <label>Название напитка:</label><input type="text" id="edit-recipe-name" value="${recipe.name}">
                <label>Ссылка на изображение (с GitHub):</label><input type="text" id="edit-image-url" value="${recipe.imageUrl || ''}">
                <div id="edit-steps-container">${stepsHtml}</div>
                <button onclick="addStep('${key}')">+ Добавить шаг</button><hr style="margin: 20px 0;">
                <div class="edit-controls">
                     <button class="btn-primary" onclick="saveRecipeEdit('${key}')">Сохранить</button>
                     <button class="btn" onclick="renderContent('recipe', '${key}')">Отмена</button>
                     <button class="btn-danger" style="float: right;" onclick="deleteItem('recipe', '${key}')">Удалить</button>
                </div>
            </div>`;
        initSortables(key);
    }
    
    function renderPrepEdit(key) {
        const prep = appData.preparations[key];
        const output = document.getElementById('content-output');
        output.innerHTML = `
            <div class="edit-form">
                <h2>Редактирование "${prep.name}"</h2>
                <label>Название заготовки:</label><input type="text" id="edit-prep-name" value="${prep.name}">
                <label>Описание / Рецепт:</label><textarea id="edit-prep-desc" rows="6">${prep.description}</textarea>
                <hr style="margin: 20px 0;">
                <div class="edit-controls">
                     <button class="btn-primary" onclick="savePrepEdit('${key}')">Сохранить</button>
                     <button class="btn" onclick="renderContent('prep', '${key}')">Отмена</button>
                     <button class="btn-danger" style="float: right;" onclick="deleteItem('prep', '${key}')">Удалить</button>
                </div>
            </div>`;
    }
    
    function renderEditStep(key, step, stepIndex) {
        let ingredientsHtml = step.ingredientKeys.map(ingKey => {
             const ingData = appData.recipes[key].allIngredients[ingKey];
             if(!ingData) return '';
             return `<div class="edit-ingredient" data-ing-key="${ingKey}">
                        <input type="text" value="${ingData.name}" placeholder="Название">
                        <input type="text" value="${ingData.size500}" placeholder="500мл">
                        <input type="text" value="${ingData.size650}" placeholder="650мл">
                        <button onclick="removeIngredientFromStep(this)">&times;</button>
                    </div>`;
        }).join('');
        return `<div class="edit-step" data-step-index="${stepIndex}">
                    <h4>Шаг ${stepIndex + 1}</h4>
                    <textarea rows="2" placeholder="Описание шага">${step.description}</textarea>
                    <div class="edit-ingredient-header"><span>Ингредиент</span><span>500мл</span><span>650мл</span></div>
                    <div class="edit-ingredient-container">${ingredientsHtml}</div>
                    <button onclick="addIngredientToStep(this)">+ Ингредиент</button>
                    <button class="btn-danger" onclick="removeStep(this)">Удалить шаг</button>
                </div>`;
    }

    function saveRecipeEdit(key) {
        const newName = document.getElementById('edit-recipe-name').value.trim();
        if (!newName) { alert('Название напитка не может быть пустым.'); return; }
        
        const editedRecipe = { 
            name: newName, 
            imageUrl: document.getElementById('edit-image-url').value.trim(), 
            allIngredients: {}, 
            steps: [] 
        };
        
        document.querySelectorAll('#edit-steps-container .edit-step').forEach(stepEl => {
            const description = stepEl.querySelector('textarea').value;
            const newStep = { description: description, ingredientKeys: [] };
            stepEl.querySelectorAll('.edit-ingredient').forEach(ingEl => {
                const ingKey = ingEl.dataset.ingKey;
                const inputs = ingEl.querySelectorAll('input');
                const ingName = inputs[0].value.trim();
                if (!ingName) return;
                editedRecipe.allIngredients[ingKey] = { name: ingName, size500: inputs[1].value, size650: inputs[2].value };
                newStep.ingredientKeys.push(ingKey);
            });
            editedRecipe.steps.push(newStep);
        });

        appData.recipes[key] = editedRecipe;
        saveData();
        renderRecipeForVolume(key, selectedVolume || '500');
    }

    function savePrepEdit(key) {
        const newName = document.getElementById('edit-prep-name').value.trim();
        if (!newName) { alert('Название заготовки не может быть пустым.'); return; }
        appData.preparations[key] = { name: newName, description: document.getElementById('edit-prep-desc').value };
        saveData();
        renderContent('prep', key);
    }
    
    function deleteItem(type, key) {
        const collection = type === 'recipe' ? appData.recipes : appData.preparations;
        const name = collection[key].name;
        if (confirm(`Вы уверены, что хотите удалить "${name}"?`)) {
            delete collection[key];
            saveData();
            activeKey = null;
            document.getElementById('content-output').innerHTML = `<div class="content-placeholder"><p>Элемент удален.</p></div>`;
            renderLists();
        }
    }
    
    function addStep(key) {
        appData.recipes[key].steps.push({ description: 'Новый шаг', ingredientKeys: [] });
        renderRecipeEdit(key);
    }
    function removeStep(element) { element.closest('.edit-step').remove(); }
    function addIngredientToStep(element) {
        const container = element.previousElementSibling;
        const newIngKey = 'ing_' + Date.now();
        const newIngDiv = document.createElement('div');
        newIngDiv.className = 'edit-ingredient';
        newIngDiv.dataset.ingKey = newIngKey;
        newIngDiv.innerHTML = `<input type="text" placeholder="Название"><input type="text" placeholder="500мл"><input type="text" placeholder="650мл"><button onclick="removeIngredientFromStep(this)">&times;</button>`;
        container.appendChild(newIngDiv);
    }
    function removeIngredientFromStep(element) { element.closest('.edit-ingredient').remove(); }
    
    function initSortables(key) {
        destroySortables();
        const stepsContainer = document.getElementById('edit-steps-container');
        if (stepsContainer) {
            sortableInstances.push(new Sortable(stepsContainer, { animation: 150, handle: 'h4', ghostClass: 'sortable-ghost' }));
        }
        document.querySelectorAll('.edit-ingredient-container').forEach(container => {
            sortableInstances.push(new Sortable(container, { animation: 150, ghostClass: 'sortable-ghost' }));
        });
    }
    function destroySortables() {
        sortableInstances.forEach(s => s.destroy());
        sortableInstances = [];
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        renderLists();
        
        document.querySelector('.sidebar-tabs').addEventListener('click', e => {
            if (e.target.tagName !== 'BUTTON') return;
            const newTab = e.target.id === 'tab-drinks' ? 'drinks' : 'preps';
            if (newTab === activeTab) return;
            activeTab = newTab;
            
            document.getElementById('tab-drinks').classList.toggle('active', activeTab === 'drinks');
            document.getElementById('drinks-list').style.display = activeTab === 'drinks' ? '' : 'none';
            document.getElementById('tab-preps').classList.toggle('active', activeTab === 'preps');
            document.getElementById('preps-list').style.display = activeTab === 'preps' ? '' : 'none';
            document.getElementById('new-item-btn').textContent = activeTab === 'drinks' ? 'Создать новый напиток' : 'Создать заготовку';
            
            activeKey = null;
            document.getElementById('content-output').innerHTML = `<div class="content-placeholder"><p>← Выберите элемент из меню</p></div>`;
            renderLists();
        });
        
        document.querySelector('.sidebar-content').addEventListener('click', e => {
            const link = e.target.closest('a');
            if (link) {
                e.preventDefault();
                renderContent(link.dataset.type, link.dataset.key);
            }
        });
        
        document.getElementById('new-item-btn').addEventListener('click', () => {
            const key = (activeTab === 'drinks' ? 'recipe_' : 'prep_') + Date.now();
            if (activeTab === 'drinks') {
                appData.recipes[key] = { name: 'Новый напиток', imageUrl: '', allIngredients: {}, steps: [{ description: 'Первый шаг', ingredientKeys: [] }] };
                renderRecipeEdit(key);
            } else {
                appData.preparations[key] = { name: 'Новая заготовка', description: '' };
                renderPrepEdit(key);
            }
            activeKey = key;
            renderLists();
        });
    });
    </script>
</body>
</html>
